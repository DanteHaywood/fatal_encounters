<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Fatal Encounters</title>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
	<script src="https://d3js.org/d3.v5.min.js"></script>

</head>
<body>
	<div class="content">
		<div class="chart-container">
			<canvas id="myChart"></canvas>
		</div>
		<h3>hurrrrr</h3>
		<div class="chart-container" >
			<canvas id="feByYear"></canvas>
		</div>
		<div class="chart-container" >
			<canvas id="feByGender"></canvas>
		</div>
		<div class="chart-container">

			<canvas id="feByRace"></canvas>
		</div>
	</div>

	<script>

	$(document).ready(function(){
		d3.csv("https://raw.githubusercontent.com/DanteHaywood/fatal_encounters/master/FATAL%20ENCOUNTERS%20WEB.csv")
		.then(function(data) {
			// Data from d3.csv is parsed into rows as objects and columns into key-values
			// Need to transform the row-wise structure into single columns as arrays
			// Chart.js needs data as "columnar" arrays - the opposite of d3
		  console.log(data);
			/*
			var ages = [],
				dates = [],
				genders = [],
				years = [],
				races = []

			data.map(function(d) {
				ages.push(d.age);
				dates.push(d.dates);
				genders.push(d.gender);
				years.push(d.years);
				races.push(d.race_imputation);
			})
			*/

			const groupCount = function(data, group){

				var nested = d3.nest()
					.key(function(d) { return d[group] })
					.rollup(function(d) {
						return d3.sum(d, function(g) { return 1 })
					})
					.entries(data)
				;

				nested = nested.filter(function(d){
					keyUpper = d.key.toUpperCase();
					return (
						(keyUpper !== "#REF!") &&
						(keyUpper !== "#VALUE!") &&
						(keyUpper !== "2100") &&
						(keyUpper !== "NA") &&
						(keyUpper !== "NULL") &&
						// Remove erroneous data
						(d.value > 3)
					)
				})

				return nested;
			}

			const feByYear = groupCount(data, "year");
			const feByGender = groupCount(data, "gender");
			const feByRace = groupCount(data, "race_imputation");

			console.log(feByYear);

			const getKeys = function(obj){
				var keys = [];
				obj.map(function(d){
					keys.push(d.key)
				})
				return keys;
			}

			const getValues = function(obj){
				var values = [];
				obj.map(function(d){
					values.push(d.value)
				})
				return values;
			}

			const get_random_color = function() {
			  function c() {
			    var hex = Math.floor(Math.random()*256).toString(16);
			    return ("0"+String(hex)).substr(-2); // pad with zero
			  }
			  return "#"+c()+c()+c();
			}

			///////////////////////
			// FE by Year Line Chart
			///////////////////////
			var ctx_feByYear = document.getElementById('feByYear').getContext('2d');
			var myChart2 = new Chart(ctx_feByYear,{
				"type":"line",

				"data":{
					"labels":getKeys(feByYear),

					"datasets":[{
						"label":"Fatal Encounters",
						"data":getValues(feByYear),
						"backgroundColor":"#d10000",
						"fill":false,
						"borderColor":"#d10000",
						"pointHoverRadius":10,
						"lineTension":0.1}
					]},
				"options":{
					title: {
						display: true,
						text: 'Fatal Encounters by Year'
					}
				}
			});

				///////////////////////
				// FE by Race bar Chart
				///////////////////////

				var ctx_feByRace = document.getElementById('feByRace').getContext('2d');
				var myChart2 = new Chart(ctx_feByRace,{
					"type":"doughnut",

					"data":{
						"labels":getKeys(feByRace),
						"datasets":[{
							//"label":"Fatal Encounters",
							"data":getValues(feByRace),
							"backgroundColor":d3.schemeCategory10,
							"weight":2}
						]},
					"options":{
						title: {
							display: true,
							text: 'Fatal Encounters by Race'
						}
					}
				});



		});
		var ctx = document.getElementById('myChart').getContext('2d');
		var myChart = new Chart(ctx,{
			"type":"line",
			"data":{"labels":["January","February","March","April","May","June","July"],
				"datasets":[{
					"label":"My First Dataset",
					"data":[65,59,80,81,56,55,40],
					"fill":false,
					"borderColor":"rgb(75, 192, 192)",
					"lineTension":0.1}
				]},
			"options":{}});
		/*
		var myChart = new Chart(ctx, {
		    type: 'bar',
		    data: {
		        labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
		        datasets: [{
		            label: '# of Votes',
		            data: [12, 19, 3, 5, 2, 3],
		            backgroundColor: [
		                'rgba(255, 99, 132, 0.2)',
		                'rgba(54, 162, 235, 0.2)',
		                'rgba(255, 206, 86, 0.2)',
		                'rgba(75, 192, 192, 0.2)',
		                'rgba(153, 102, 255, 0.2)',
		                'rgba(255, 159, 64, 0.2)'
		            ],
		            borderColor: [
		                'rgba(255, 99, 132, 1)',
		                'rgba(54, 162, 235, 1)',
		                'rgba(255, 206, 86, 1)',
		                'rgba(75, 192, 192, 1)',
		                'rgba(153, 102, 255, 1)',
		                'rgba(255, 159, 64, 1)'
		            ],
		            borderWidth: 1
		        }]
		    },
		    options: {
		        scales: {
		            yAxes: [{
		                ticks: {
		                    beginAtZero: true
		                }
		            }]
		        }
		    }
		});
	*/
	})
	</script>
</body>
</html>
